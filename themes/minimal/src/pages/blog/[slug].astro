---
import { content } from "@local/content";
import { MarkdocRenderer } from "@local/markdoc-renderer";
import { SITE_TITLE } from "../../config";

import BlogPostMeta from "../../components/BlogPostMeta.astro";
import BlogPostLayout from "../../layouts/BlogPostLayout.astro";

export async function getStaticPaths() {
  const { blog } = await content.glob();

  return blog.map((post) => {
    return { params: { slug: post.slug } };
  });
}

const { slug } = Astro.params;
if (typeof slug !== "string") {
  throw Error(`slug should be string. Received: ${slug}`);
}

const post = await content.globPostBySlug({ slug });

if (!post) {
  throw Error("Post not found");
}
---

<BlogPostLayout
  title={post.frontmatter.title}
  publishDate={post.frontmatter.date}
>
  <BlogPostMeta
    title={post.frontmatter.title}
    description={post.frontmatter.isExternal
      ? undefined
      : post.frontmatter.description}
    publishDate={post.frontmatter.date.toISOString()}
    slot="head"
  />
  <MarkdocRenderer content={post.content} />
</BlogPostLayout>
